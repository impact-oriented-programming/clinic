{% load static %}
{% load crispy_forms_tags %}
{% load custom_tags %}
<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.10/css/all.css">
  <link rel="stylesheet" type="text/css" href="{% static 'doctor_interface/style_interface.css'%}">

  <script src="{% static 'reception_desk/scripts.js' %}"></script>

  <meta charset="UTF-8">
  <link rel="shortcut icon" href="{% static 'images/favicon.ico' %}" />
  <title>Dr. {{ user.first_name}} {{user.last_name}}</title>

</head>
<body>
  <a href="#" id="back-to-top" class="back-to-top" style="display: inline;"><img src="{% static 'images/totop_blue.png' %}" ></a>
  <h1 class="title", style="text-align:center"> Welcome Dr. {{ user.first_name }} {{ user.last_name }}</h1>
  <hr>
  <div class="btn-group clearfix" style="width: 99%">
    <a class="btn btn-info left clearfix" style="width:33.3%; border: 1px solid  #718fbd;" href="{% url 'home' %}">Home Page</a>
    <a class="btn btn-info left clearfix" style="width:33.3%; border: 1px solid  #718fbd;"  href="{% url 'reception_desk:calendar' %}" >Clinic's Calendar</a>
    <a class="btn btn-info left clearfix" style="width:33.3%; border: 1px solid  #718fbd;" href="{% url 'logout' %}" >Logout</a>
  </div>
  <hr>
  <div class="table-title">
    <h2 style="color: #283955;">Today's Appointments</h2>
    {% if today_appointments %}
    <p style="color: #283955;">Click on patient to view their profile</p>
    {% endif %}
  </div>
  {% if today_appointments %}
  <div class="table-title">
    <h3 style="color: #283955;">Waiting Patients</h3>
  </div>
  {% if app_arrived %}
  <table class="table-fill" style="width:99.9%;">
    <thead>
      <tr>
        <th style="width:20%;">Patient</th>
        <th style="width:20%;">Clinic ID</th>
        <th style="width:20%;">Visa Number</th>
        <th style="width:20%;">Time Scheduled</th>
        <th style="width:20%;">Time Waiting</th>
      </tr>
    </thead>
    <tbody class="table-hover">
      {% for appointment in app_arrived %}
      <tr>
        <td><a href="{% url 'doctor_interface:patient_interface' appointment.pk%}" target="_blank">{{ appointment.patient }}</a></td>
        <td>{{ appointment.patient.clinic_identifying_number }}</td>
        <td>{{ appointment.patient.visa_number }}</td>
        <td>{{ appointment.start_time | time:"H:i" }}</td>
        <td>
          {% if not appointment.done %}
          <div id="{{appointment.id}}"></div>
          <script>startTime({{ appointment.arrived | get_hour }}, {{appointment.arrived | get_minute }},{{ appointment.id | js_safe }});</script>
          {% endif %}
        </td>
      </tr>
      {% endfor %}
      {% else %}
      <div class="table-title">
        <p style="color: #283955;">No Patients are waiting right now. Refresh page to view the most updated information.</p>
      </div>
      {% endif %}
    </tbody>
  </table>
  <p></p>
  <div class="table-title">
    <h3 style="color: #283955;">Later Today</h3>
  </div>
  {% if app_not_arrived %}
  <table class="table-fill" style="width:99.9%;">
    <thead>
      <tr>
        <th style="width:25%;">Patient</th>
        <th style="width:25%;">Clinic ID</th>
        <th style="width:25%;">Visa Number</th>
        <th style="width:25%;">Time Scheduled</th>
      </tr>
    </thead>
    <tbody class="table-hover">
      {% for appointment in app_not_arrived %}
      <tr>
        <td><a href="{% url 'doctor_interface:patient_interface' appointment.pk %}" target="_blank">{{ appointment.patient }}</a></td>
        <td>{{ appointment.patient.clinic_identifying_number }}</td>
        <td>{{ appointment.patient.visa_number }}</td>
        <td>{{ appointment.start_time | time:"H:i" }}</td>
      </tr>
      {% endfor %}
      {% else %}
      <div class="table-title">
        <p style="color: #283955;">No other appointments are scheduled for today!</p>
      </div>
      {% endif %}
          </tbody>
  </table>
    {% else %}
  <div class="table-title">
    <p style="color: #283955;">No Appointments for today!</p>
  </div>
{% endif %}
      <hr>
  <div class="table-title">
    <p></p>
    <h3 style="color: #283955;">Browse Patients</h3>
    <!--<p style="color: #283955;">Enter patient clinic ID or visa number:</p>-->
    <div class="content-section">
        <form method="POST" target="_blank">
            {% csrf_token %}
            <fieldset class="form-group">
                {{ form|crispy }}
            </fieldset>
            <div class="form-group">
               <input class="btn btn-outline-info" type="submit" value="Submit">
            </div>
        </form>
    </div>
  </div>
  <hr>
  <p></p>
{% if today_appointments %}
  <div class="table-title">
    <h3 style="color: #283955;">Done Appointments</h3>
  </div>
      {% if app_done %}
  <table class="table-fill">
    <thead>
      <tr>
        <th>Patient</th>
        <th>Clinic ID</th>
        <th>Visa Number</th>
        <th>Time Finished</th>
      </tr>
    </thead>
    <tbody class="table-hover">
      {% for appointment in app_done %}
      <tr>
        <td><a href="{% url 'doctor_interface:patient_interface' appointment.pk %}">{{ appointment.patient }}</a></td>
        <td>{{ appointment.patient.clinic_identifying_number }}</td>
        <td>{{ appointment.patient.visa_number }}</td>
        <td>{{ appointment.done }}</td>
      </tr>
      {% endfor %}
      {% else %}
      <div class="table-title">
        <p style="color: #283955;">No appointments are done yet!</p>
      </div>
      {% endif %}
    </tbody>
  </table>
<hr>
  {% endif %}
  <!-- Fades in the button when you scroll down -->
  <script>
    var link = document.getElementById("back-to-top");
    var amountScrolled = 250;

    window.addEventListener('scroll', function(e) {
        if ( window.pageYOffset > amountScrolled ) {
            link.classList.add('show');
        } else {
            link.className = 'back-to-top';
        }
    });

  <!-- Scroll to Top -->
    link.addEventListener('click', function(e) {
        e.preventDefault();

        var distance = 0 - window.pageYOffset;
        var increments = distance/(500/16);
        function animateScroll() {
            window.scrollBy(0, increments);
            if (window.pageYOffset <= document.body.offsetTop) {
                clearInterval(runAnimation);
            }
        };
        // Loop the animation function
        var runAnimation = setInterval(animateScroll, 16);
    });
  </script>
</body>
